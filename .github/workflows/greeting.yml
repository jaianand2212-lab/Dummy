name: Greeting on Push with Email Notification

# Trigger: Run this workflow when code is pushed to any branch
on:
  push:
    branches:
      - '**'  # Triggers on push to any branch

jobs:
  send-greeting:
    name: Send Greeting Message and Email
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v4
      
      # Step 2: Display greeting message in logs
      - name: Send Greeting
        run: |
          echo "=================================================="
          echo "üéâ Greetings, you have successfully pushed the code!"
          echo "=================================================="
          echo ""
          echo "üìã Push Details:"
          echo "  Repository: ${{ github.repository }}"
          echo "  Branch: ${{ github.ref_name }}"
          echo "  Commit: ${{ github.sha }}"
          echo "  Author: ${{ github.actor }}"
          echo "  Message: ${{ github.event.head_commit.message }}"
          echo ""
          echo "‚úÖ Workflow completed successfully!"
          echo "=================================================="
      
      # Step 3: Check if email secrets are configured
      - name: Verify Email Configuration
        run: |
          if [ -z "${{ secrets.EMAIL_USERNAME }}" ]; then
            echo "‚ùå ERROR: EMAIL_USERNAME secret is not set!"
            echo "Please configure it at: https://github.com/${{ github.repository }}/settings/secrets/actions"
          else
            echo "‚úÖ EMAIL_USERNAME is configured"
          fi
          
          if [ -z "${{ secrets.EMAIL_PASSWORD }}" ]; then
            echo "‚ùå ERROR: EMAIL_PASSWORD secret is not set!"
          else
            echo "‚úÖ EMAIL_PASSWORD is configured"
          fi
          
          if [ -z "${{ secrets.EMAIL_TO }}" ]; then
            echo "‚ùå ERROR: EMAIL_TO secret is not set!"
          else
            echo "‚úÖ EMAIL_TO is configured: Sending to ${{ secrets.EMAIL_TO }}"
          fi
      
      # Step 4: Send Email Notification
      - name: Send Greeting Email
        if: ${{ secrets.EMAIL_USERNAME != '' && secrets.EMAIL_PASSWORD != '' && secrets.EMAIL_TO != '' }}
        uses: dawidd6/action-send-mail@v3
        with:
          # SMTP server configuration
          server_address: smtp.gmail.com
          server_port: 587
          secure: true
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          
          # Email details
          subject: "‚úÖ Greetings! Code Successfully Pushed to ${{ github.repository }}"
          to: ${{ secrets.EMAIL_TO }}
          from: ${{ secrets.EMAIL_USERNAME }}
          
          # Simplified email body
          body: |
            üéâ Greetings, you have successfully pushed the code!
            
            ================================================
            üìã PUSH DETAILS
            ================================================
            
            Repository: ${{ github.repository }}
            Branch: ${{ github.ref_name }}
            Commit: ${{ github.sha }}
            Author: ${{ github.actor }}
            Message: ${{ github.event.head_commit.message }}
            Timestamp: ${{ github.event.head_commit.timestamp }}
            
            ================================================
            
            ‚úÖ Your code push was successful!
            
            View commit: https://github.com/${{ github.repository }}/commit/${{ github.sha }}
            
            ---
            This is an automated message from GitHub Actions
            Repository: ${{ github.repository }}
            Workflow: ${{ github.workflow }}
          
          # HTML version (optional)
          html_body: |
            <!DOCTYPE html>
            <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f4f4f4; padding: 20px; }
                .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
                .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 20px; text-align: center; }
                .header h1 { margin: 0; font-size: 28px; }
                .content { padding: 30px; }
                .success-box { background: #d4edda; border-left: 5px solid #28a745; padding: 15px; margin: 20px 0; border-radius: 5px; }
                .details { background: #f8f9fa; padding: 20px; border-radius: 5px; margin: 20px 0; }
                .detail-row { padding: 10px 0; border-bottom: 1px solid #dee2e6; }
                .detail-row:last-child { border-bottom: none; }
                .label { font-weight: bold; color: #667eea; display: inline-block; width: 150px; }
                .button { display: inline-block; background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; margin: 20px 0; }
                .footer { background: #333; color: white; text-align: center; padding: 20px; font-size: 12px; }
              </style>
            </head>
            <body>
              <div class="container">
                <div class="header">
                  <h1>üéâ Greetings!</h1>
                  <p>Code Push Successful</p>
                </div>
                
                <div class="content">
                  <div class="success-box">
                    <strong>‚úÖ You have successfully pushed the code to your repository!</strong>
                  </div>
                  
                  <div class="details">
                    <div class="detail-row">
                      <span class="label">Repository:</span>
                      <span>${{ github.repository }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Branch:</span>
                      <span>${{ github.ref_name }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Commit:</span>
                      <span><code>${{ github.sha }}</code></span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Author:</span>
                      <span>${{ github.actor }}</span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Message:</span>
                      <span><em>${{ github.event.head_commit.message }}</em></span>
                    </div>
                    <div class="detail-row">
                      <span class="label">Timestamp:</span>
                      <span>${{ github.event.head_commit.timestamp }}</span>
                    </div>
                  </div>
                  
                  <center>
                    <a href="https://github.com/${{ github.repository }}/commit/${{ github.sha }}" class="button">
                      View Commit on GitHub
                    </a>
                  </center>
                </div>
                
                <div class="footer">
                  <p>This is an automated message from GitHub Actions</p>
                  <p>Repository: ${{ github.repository }} | Workflow: ${{ github.workflow }}</p>
                </div>
              </div>
            </body>
            </html>
      
      # Step 5: Log result
      - name: Post Success Status
        if: success()
        run: |
          echo "::notice::‚úÖ Greetings! Code push was successful and email notification sent for commit ${{ github.sha }}"
      
      - name: Post Failure Status
        if: failure()
        run: |
          echo "::error::‚ùå Email notification failed! Please check:"
          echo "  1. Secrets are configured: https://github.com/${{ github.repository }}/settings/secrets/actions"
          echo "  2. EMAIL_USERNAME, EMAIL_PASSWORD, EMAIL_TO are set correctly"
          echo "  3. If using Gmail, App Password is generated (not regular password)"
          echo "  4. Check workflow logs for detailed error messages"
