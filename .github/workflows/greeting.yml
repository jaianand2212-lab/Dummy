name: Greeting on Push with Email Notification

# Trigger: Run this workflow when code is pushed to any branch
on:
  push:
    branches:
      - '**'  # Triggers on push to any branch

jobs:
  send-greeting:
    name: Send Greeting Message and Email
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v4
      
      # Step 2: Display greeting message in logs
      - name: Send Greeting
        run: |
          echo "=================================================="
          echo "ðŸŽ‰ Greetings, you have successfully pushed the code!"
          echo "=================================================="
          echo ""
          echo "ðŸ“‹ Push Details:"
          echo "  Repository: ${{ github.repository }}"
          echo "  Branch: ${{ github.ref_name }}"
          echo "  Commit: ${{ github.sha }}"
          echo "  Author: ${{ github.actor }}"
          echo "  Message: ${{ github.event.head_commit.message }}"
          echo ""
          echo "âœ… Workflow completed successfully!"
          echo "=================================================="
      
      # Step 3: Send Email Notification
      - name: Send Greeting Email
        uses: dawidd6/action-send-mail@v3
        with:
          # SMTP server configuration (using Gmail as example)
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          
          # Email details
          subject: "âœ… Code Successfully Pushed to ${{ github.repository }}"
          to: ${{ secrets.EMAIL_TO }},${{ secrets.EMAIL_TO_SECONDARY }}
          from: GitHub Actions <noreply@github.com>
          cc: ${{ secrets.EMAIL_CC }}  # Optional CC recipients
          
          # Email body (HTML format)
          html_body: |
            <!DOCTYPE html>
            <html>
            <head>
              <style>
                body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
                .content { background: #f9f9f9; padding: 30px; border: 1px solid #ddd; }
                .success-box { background: #d4edda; border-left: 4px solid #28a745; padding: 15px; margin: 20px 0; border-radius: 5px; }
                .details { background: white; padding: 20px; border-radius: 5px; margin: 15px 0; }
                .detail-row { padding: 8px 0; border-bottom: 1px solid #eee; }
                .detail-label { font-weight: bold; color: #667eea; }
                .footer { background: #333; color: white; text-align: center; padding: 20px; border-radius: 0 0 10px 10px; }
                .emoji { font-size: 24px; }
              </style>
            </head>
            <body>
              <div class="container">
                <div class="header">
                  <h1><span class="emoji">ðŸŽ‰</span> Greetings!</h1>
                  <h2>Code Push Successful</h2>
                </div>
                
                <div class="content">
                  <div class="success-box">
                    <strong>âœ… You have successfully pushed the code to your repository!</strong>
                  </div>
                  
                  <div class="details">
                    <h3>ðŸ“‹ Push Details:</h3>
                    <div class="detail-row">
                      <span class="detail-label">Repository:</span> 
                      ${{ github.repository }}
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Branch:</span> 
                      ${{ github.ref_name }}
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Commit SHA:</span> 
                      <code>${{ github.sha }}</code>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Author:</span> 
                      ${{ github.actor }}
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Commit Message:</span> 
                      <em>${{ github.event.head_commit.message }}</em>
                    </div>
                    <div class="detail-row">
                      <span class="detail-label">Timestamp:</span> 
                      ${{ github.event.head_commit.timestamp }}
                    </div>
                  </div>
                  
                  <p style="text-align: center; margin-top: 30px;">
                    <a href="https://github.com/${{ github.repository }}/commit/${{ github.sha }}" 
                       style="background: #667eea; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;">
                      View Commit on GitHub
                    </a>
                  </p>
                </div>
                
                <div class="footer">
                  <p>This is an automated message from GitHub Actions</p>
                  <p style="font-size: 12px; margin-top: 10px;">
                    Repository: ${{ github.repository }} | Workflow: ${{ github.workflow }}
                  </p>
                </div>
              </div>
            </body>
            </html>
          
          # Convert HTML to text for plain text email clients
          convert_markdown: true
      
      # Step 4: Create a success notification
      - name: Post Success Status
        run: |
          echo "::notice::Greetings! Code push was successful and email notification sent for commit ${{ github.sha }}"
